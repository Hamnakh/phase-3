<!--
================================================================================
SYNC IMPACT REPORT
================================================================================
Version change: N/A (template) -> 1.0.0 (initial)
Bump rationale: MAJOR - Initial constitution establishment

Modified principles: N/A (new document)

Added sections:
- 5 Core Principles (Specs First, Claude Code Builds, Specs Truth, Monorepo, Security)
- Architecture Principles section (Frontend/Backend/Database/Auth/API)
- Development Workflow section
- Governance section with forbidden items and success criteria

Removed sections: All template placeholders replaced

Templates requiring updates:
- plan-template.md: Compatible (Constitution Check section exists)
- spec-template.md: Compatible (Requirements section aligns)
- tasks-template.md: Compatible (Phase structure aligns with workflow)
- checklist-template.md: Compatible (generic template)
- agent-file-template.md: Compatible (generic template)

Follow-up TODOs: None - all placeholders resolved
================================================================================
-->

# Hackathon Todo App Constitution

**Phase II - Full-Stack Web Application**

This constitution defines how this project will be built using **Spec-Driven Development**, **Claude Code**, and **Spec-Kit Plus**.
No development shall occur outside the rules stated in this constitution.

## Purpose

Transform the Todo application into a secure, multi-user, full-stack web system with:

- Persistent storage
- Authentication
- Secure REST APIs
- Proper frontend + backend structure
- AI-driven development workflow

## Core Principles

### I. Specs First - Code Second

Development MUST start by writing or updating a spec. No implementation work shall begin without a corresponding specification document. This ensures:

- Clear requirements before coding
- Documented decisions and rationale
- Traceable feature development

### II. Claude Code Builds - Humans Supervise

Implementation MUST be generated by Claude Code. Manual core coding is NOT allowed. Humans:

- Write and approve specifications
- Review generated code
- Test functionality
- Provide feedback for regeneration

### III. Specs Are Source of Truth

If code and spec conflict, the **spec wins**. This means:

- Code MUST be regenerated to match spec
- Specs MUST NOT be modified to match incorrect code
- All behavior disputes are resolved by consulting the spec

### IV. Monorepo Required

All components MUST live in one repository with this structure:

```text
hackathon-todo/
├── frontend/
├── backend/
├── specs/
└── .spec-kit/
```

Violations of this structure are forbidden.

### V. Security Mandatory

Every user MUST only access their own data. Security is non-negotiable:

- Cross-user data access is strictly forbidden
- All endpoints MUST verify user ownership
- JWT authentication MUST be enforced on all protected routes

## Architecture Principles

### Frontend

- **Framework**: Next.js (App Router)
- **Authentication**: Better Auth
- **JWT Handling**: MUST attach JWT to all protected API calls
- **Guidance**: MUST follow `/frontend/CLAUDE.md`

### Backend

- **Framework**: FastAPI
- **ORM**: SQLModel
- **Database**: Neon Serverless PostgreSQL
- **JWT Handling**: MUST verify JWT on all protected endpoints
- **Guidance**: MUST follow `/backend/CLAUDE.md`

### Database

- **Engine**: PostgreSQL (Neon Serverless)
- **User Isolation**: Tasks MUST be tied to users via `user_id`
- **Schema**: MUST follow `/specs/database/schema.md`

### Authentication Requirements

- Better Auth MUST issue JWT tokens
- Frontend MUST attach JWT in header: `Authorization: Bearer <token>`
- Backend MUST verify JWT using shared secret
- Missing or invalid token MUST return `401 Unauthorized`
- Cross-user access is strictly forbidden

### REST API Requirements

- All endpoints MUST require a valid JWT
- Endpoints MUST only return authenticated user's data
- MUST follow `/specs/api/rest-endpoints.md`
- MUST use proper HTTP status codes

## Development Workflow

All feature development MUST follow this workflow:

1. **Write or update spec** - Define the feature in `/specs/`
2. **Reference spec in Claude Code prompt** - Point to the relevant spec
3. **Claude Code implements** - Generate the code
4. **Test functionality** - Verify implementation matches spec
5. **Update spec if needed** - Refine and regenerate

### Spec Structure

Specs define everything and MUST exist at:

```text
/specs/overview.md
/specs/features/
/specs/api/
/specs/database/
/specs/ui/
```

Implementation is ONLY valid if:

- Feature spec exists
- API spec exists
- Database spec supports it

### Environment Rules

Frontend and backend MUST share these environment variables:

- `BETTER_AUTH_SECRET` / `JWT_SECRET` - Shared secret for JWT
- `DATABASE_URL` - Backend only
- `API_BASE_URL` - Frontend only

Secrets MUST **never** be committed to the repository.

## Governance

### Forbidden Actions

The following are strictly forbidden:

- Manual feature coding (bypassing Claude Code)
- Skipping specs (implementing without specification)
- Hard-coded secrets (credentials in code)
- Violating monorepo structure
- Bypassing authentication checks

### Success Definition

The project is considered correct when:

- Login and signup work correctly
- JWT-based security is enforced
- Users can only see their own tasks
- Full CRUD functionality works
- Data persists in the database
- All behavior matches the specs

### Amendment Process

1. Propose changes via spec update
2. Document rationale for change
3. Update constitution version following semantic versioning
4. Regenerate affected code to comply

### Compliance Review

- All PRs/reviews MUST verify compliance with this constitution
- Complexity MUST be justified against these principles
- Use agent-specific CLAUDE.md files for runtime development guidance

### Final Law

This project shall always remain:

**Spec-Driven - Secure - Structured - AI-Collaborative**

**Version**: 1.0.0 | **Ratified**: 2025-12-27 | **Last Amended**: 2025-12-27
